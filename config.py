import os
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env
load_dotenv()

# ========== –ë–ê–ó–û–í–´–ï –ù–ê–°–¢–†–û–ô–ö–ò –ë–û–¢–ê ==========
# –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ .env —Ñ–∞–π–ª–∞
BOT_TOKEN = os.getenv('BOT_TOKEN')

# URL –¥–ª—è MiniApp (–≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
MINIAPP_URL = os.getenv('MINIAPP_URL', 'https://vovsetyagskie.bothost.ru')

# ========== –ù–ê–°–¢–†–û–ô–ö–ò –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–û–í ==========
# –°–ø–∏—Å–æ–∫ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (—É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –≤ .env)
ADMIN_IDS_STR = os.getenv('ADMIN_IDS', '')

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ —Å–ø–∏—Å–æ–∫ —á–∏—Å–µ–ª
ADMIN_IDS = [8473513085,356633485]
if ADMIN_IDS_STR:
    try:
        # –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ –∑–∞–ø—è—Ç–æ–π, —É–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ int
        ADMIN_IDS = [int(id_str.strip()) for id_str in ADMIN_IDS_STR.split(',') if id_str.strip()]
    except ValueError as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ ADMIN_IDS: {e}")
        ADMIN_IDS = []

# ========== –ù–ê–°–¢–†–û–ô–ö–ò –ë–û–ù–£–°–ù–û–ô –°–ò–°–¢–ï–ú–´ ==========
# –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤ –æ—Ç —Å—É–º–º—ã —á–µ–∫–∞
BONUS_PERCENTAGE = 5

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ–ø–ª–∞—Ç—ã –±–æ–Ω—É—Å–∞–º–∏
MAX_BONUS_SPEND_PERCENT = 50

# –ë–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
WELCOME_BONUS = 100

# –ë–æ–Ω—É—Å –∑–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
REFERRAL_BONUS = 25

# ========== –ù–ê–°–¢–†–û–ô–ö–ò –ë–ê–ó–´ –î–ê–ù–ù–´–• ==========
DB_NAME = os.getenv('DB_NAME', 'loyalty_bot.db')

# ========== –ù–ê–°–¢–†–û–ô–ö–ò –°–û–û–ë–©–ï–ù–ò–ô ==========
# –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—Å–µ–∫—É–Ω–¥—ã)
MESSAGE_CLEANUP_DELAY = 30

# ========== –ù–ê–°–¢–†–û–ô–ö–ò –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø ==========
LOG_FILE = os.getenv('LOG_FILE', 'bot_errors.log')
LOG_LEVEL = os.getenv('LOG_LEVEL', 'INFO')

# ========== –ù–ê–°–¢–†–û–ô–ö–ò –ó–ê–ö–ê–ó–û–í ==========
# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
MIN_ORDER_AMOUNT = 0

# –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∑–∞–≤–µ–¥–µ–Ω–∏—è
OPENING_TIME = "10:00"
CLOSING_TIME = "23:00"

# ========== –í–ê–õ–ò–î–ê–¶–ò–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò ==========
def validate_config():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ"""
    errors = []
    
    if not BOT_TOKEN or BOT_TOKEN == "BOT_TOKEN":
        errors.append("‚ùå –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –£–∫–∞–∂–∏—Ç–µ BOT_TOKEN –≤ .env —Ñ–∞–π–ª–µ")
    
    if not ADMIN_IDS:
        print("‚ö†Ô∏è  –í–Ω–∏–º–∞–Ω–∏–µ: –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ ADMIN_IDS –≤ .env")
    
    if not MINIAPP_URL or MINIAPP_URL == "https://vovsetyagskie.bothost.ru":
        print("‚ö†Ô∏è  –í–Ω–∏–º–∞–Ω–∏–µ: URL MiniApp –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ")
    
    if errors:
        print("\n".join(errors))
        return False
    
    return True

# ========== –£–¢–ò–õ–ò–¢–´ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò ==========
def get_admin_ids():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤"""
    return ADMIN_IDS

def is_admin(user_id):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º"""
    return user_id in ADMIN_IDS

def get_bonus_percentage():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤"""
    return BONUS_PERCENTAGE

def get_max_bonus_spend_percent():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ–ø–ª–∞—Ç—ã –±–æ–Ω—É—Å–∞–º–∏"""
    return MAX_BONUS_SPEND_PERCENT

# ========== –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò ==========
def print_config_info():
    """–í—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
    print("=" * 50)
    print("üìã –¢–ï–ö–£–©–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ë–û–¢–ê")
    print("=" * 50)
    
    print(f"ü§ñ –ë–æ—Ç: {'‚úÖ –¢–æ–∫–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω' if BOT_TOKEN and BOT_TOKEN != 'BOT_TOKEN' else '‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞'}")
    print(f"üë• –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã: {len(ADMIN_IDS)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
    print(f"üåê MiniApp URL: {MINIAPP_URL}")
    print(f"üí≥ –ë–æ–Ω—É—Å—ã: {BONUS_PERCENTAGE}% –æ—Ç —Å—É–º–º—ã, –º–∞–∫—Å. {MAX_BONUS_SPEND_PERCENT}% –æ–ø–ª–∞—Ç—ã")
    print(f"üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å: {REFERRAL_BONUS} –±–∞–ª–ª–æ–≤")
    print(f"üí∞ –ë–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é: {WELCOME_BONUS} –±–∞–ª–ª–æ–≤")
    print(f"üóÑÔ∏è  –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: {DB_NAME}")
    print(f"‚è≥ –û—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π: {MESSAGE_CLEANUP_DELAY} —Å–µ–∫—É–Ω–¥")
    print("=" * 50)

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
if __name__ == "__main__":
    print_config_info()
    validate_config()
else:
    # –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    validate_config()